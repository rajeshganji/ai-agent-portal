# Testing Echo Mode - Quick Guide

## üéØ Problem You Encountered

**Expected:** System should echo back "Hello, This is Rajesh Ganji"  
**Actual:** System said "Hi there, How can I assist you today"

**Root Cause:** The system was using GPT-4o-mini to generate AI responses instead of echoing transcription.

---

## ‚úÖ Solution: ECHO_MODE

Added `ECHO_MODE` environment variable to switch between:
1. **Echo Mode** (`ECHO_MODE=true`) - Just repeats what you said
2. **AI Mode** (`ECHO_MODE=false`) - Intelligent conversational responses

---

## üîß How to Enable Echo Mode

### Option 1: Using .env file (Recommended)

Your `.env` file is already configured with `ECHO_MODE=true`:

```bash
ECHO_MODE=true
```

Just **restart your server** and it will work!

### Option 2: Railway Environment Variable

If deployed on Railway:
1. Go to Railway dashboard
2. Select your project
3. Go to **Variables** tab
4. Add: `ECHO_MODE` = `true`
5. Redeploy

---

## üß™ Testing Steps

### 1. Restart Server (Local)
```bash
cd /Users/ganjirajesh/ai-agent-portal/ai-agent-portal/agent-login-app
npm start
```

### 2. Make Test Call
- Call your Ozonetel number
- Say: "Hello, This is Rajesh Ganji"

### 3. Expected Response
**Echo Mode ON:**
```
"You said: Hello, This is Rajesh Ganji"
```

**Echo Mode OFF:**
```
"Hi there! Nice to meet you, Rajesh. How can I assist you today?"
(Generated by GPT based on intent)
```

---

## üìä What Happens Under the Hood

### Echo Mode Flow (ECHO_MODE=true)
```
1. User speaks: "Hello, This is Rajesh Ganji"
2. Whisper transcribes ‚Üí "Hello, This is Rajesh Ganji"
3. flowEngine checks ECHO_MODE ‚Üí true
4. Response = "You said: Hello, This is Rajesh Ganji"
5. ElevenLabs speaks the echo
```

### AI Mode Flow (ECHO_MODE=false)
```
1. User speaks: "Hello, This is Rajesh Ganji"
2. Whisper transcribes ‚Üí "Hello, This is Rajesh Ganji"
3. flowEngine checks ECHO_MODE ‚Üí false
4. GPT detects intent: "greeting"
5. GPT generates: "Hi there, How can I assist you today?"
6. ElevenLabs speaks the AI response
```

---

## üêõ Troubleshooting

### Issue: Still getting AI responses

**Check 1:** Verify .env file
```bash
cat agent-login-app/.env | grep ECHO_MODE
```
Should show: `ECHO_MODE=true`

**Check 2:** Restart server
```bash
# Stop current server (Ctrl+C)
npm start
```

**Check 3:** Check logs
```bash
tail -f logs/stream/stream_events_*.jsonl
```
Look for: `[FlowEngine] üîä ECHO MODE: Repeating user input`

### Issue: Transcription is wrong

This is a **Whisper API issue**, not echo mode. 

**Possible causes:**
1. Audio quality (background noise)
2. Accent/pronunciation
3. Language detection (if speaking Telugu/Tamil in 'en' mode)

**Solution:** Check language setting in streamClient.js:
```javascript
// Line 193
const defaultLanguage = process.env.DEFAULT_TRANSCRIPTION_LANGUAGE || 'en';
```

For Indian languages, keep as `'en'` - Whisper auto-detects Hindi/Telugu/Tamil.

---

## üîÑ Switching Modes

### For Development (Test Transcription)
```bash
# .env
ECHO_MODE=true
```

### For Production (AI Conversations)
```bash
# .env
ECHO_MODE=false
```

### For Railway Deployment
Set in Railway dashboard ‚Üí Variables:
- `ECHO_MODE` = `false` (production)

---

## üìù Code Changes Summary

### flowEngine.js (Line 300-355)
```javascript
// NEW: Check echo mode
const echoMode = process.env.ECHO_MODE === 'true';

if (echoMode) {
    // Just echo
    responseText = `You said: ${transcriptionText}`;
} else {
    // Use AI (original behavior)
    responseText = await openaiService.generateResponse(...);
}
```

### .env (NEW FILE)
```bash
ECHO_MODE=true  # ‚Üê This line enables echo mode
```

---

## ‚úÖ Verification Checklist

- [ ] `.env` file exists with `ECHO_MODE=true`
- [ ] Server restarted after .env change
- [ ] Made test call
- [ ] Heard "You said: [your speech]"
- [ ] Transcription is accurate
- [ ] Ready to switch to AI mode (`ECHO_MODE=false`)

---

## üéì Next Steps

1. **Test Echo Mode:** Verify transcription accuracy
2. **Test Different Languages:** Try Hindi/Telugu/Tamil
3. **Switch to AI Mode:** Set `ECHO_MODE=false`
4. **Test AI Conversations:** Natural dialogue with GPT

---

**Status:** ‚úÖ Echo mode implemented and deployed (commit `75fdf07`)

Need help? Check logs: `tail -f agent-login-app/logs/stream/stream_events_*.jsonl`
